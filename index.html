<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cité Miami — Player (GitHub hosted assets)</title>

  <style>
    /* ---------------- theme & layout ---------------- */
    :root{
      --bg:#050505;
      --panel:#0f0f0f;
      --muted:#9a9a9a;
      --gold:#d4af37;
      --accent:#ff6a00;
      --glass:rgba(255,255,255,0.03);
      --radius:12px;
      --maxw:1100px;
      --gap:14px;
      --player-height:96px; /* fixed mini-player height */
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#060606,#0d0d0d);color:#eee;font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
    a{color:inherit;text-decoration:none}
    header{position:sticky;top:0;background:linear-gradient(90deg,#0e0e0e,#131313);padding:12px 16px;border-bottom:1px solid rgba(255,255,255,.03);z-index:30;display:flex;align-items:center}
    .logo{font-weight:900;color:var(--gold);font-size:18px}
    .nav{margin-left:auto;display:flex;gap:8px}
    .nav button{background:transparent;border:1px solid rgba(255,255,255,.03);padding:8px 12px;border-radius:999px;color:#ddd;cursor:pointer;font-weight:700}
    .nav button.active{border-color:var(--gold);color:var(--gold);transform:translateY(-2px)}
    main{max-width:var(--maxw);margin:18px auto;padding:12px;padding-bottom:calc(var(--player-height) + 32px)} /* bottom padding so content not hidden behind fixed player */
    h2{margin:6px 0 12px}

    /* ---------------- feed (2:1 thumbs) ---------------- */
    .feed{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:var(--gap)}
    .tile{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:10px;border:1px solid rgba(255,255,255,.03);display:flex;flex-direction:column;gap:8px;cursor:pointer}
    .thumb{width:100%;aspect-ratio:2/1;border-radius:10px;object-fit:cover}
    .tile h4{margin:0;font-size:16px;color:var(--gold)}
    .tile p{margin:0;color:var(--muted);font-size:13px}
    .meta-row{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
    .pill{background:var(--glass);padding:6px 8px;border-radius:999px;font-size:12px;border:1px solid rgba(255,255,255,.03)}

    /* ---------------- songs grid ---------------- */
    .search-row{display:flex;gap:8px;margin-bottom:12px;align-items:center}
    input[type="search"]{flex:1;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.04);background:transparent;color:#fff}
    .songs-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:12px}
    .song-tile{display:flex;gap:12px;align-items:center;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,.03);background:linear-gradient(180deg,#0f0f0f,#131313)}
    .song-cover{width:86px;height:86px;border-radius:10px;object-fit:cover}
    .song-meta{min-width:0}
    .song-title{font-weight:800;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .song-artist{color:var(--muted);font-size:13px;margin-top:6px}
    .small-btn{background:transparent;border:1px solid rgba(255,255,255,.04);padding:8px;border-radius:8px;color:#ddd;cursor:pointer;font-weight:700}

    /* ---------------- artists / albums ---------------- */
    .artist-grid,.album-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px}
    .card{background:var(--panel);padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.03)}
    .avatar{width:100%;height:140px;object-fit:cover;border-radius:10px}

    /* ---------------- fixed mini-player (bottom) ---------------- */
    .fixed-player{position:fixed;left:0;right:0;bottom:0;height:var(--player-height);background:linear-gradient(90deg,#0f0f0f,#151515);border-top:1px solid rgba(255,255,255,.04);display:flex;align-items:center;gap:12px;padding:10px 16px;z-index:100}
    .fixed-cover{width:68px;height:68px;border-radius:8px;object-fit:cover;flex-shrink:0}
    .fixed-info{flex:1;min-width:0}
    .fixed-title{font-weight:800;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .fixed-artist{color:var(--muted);font-size:13px;margin-top:4px}
    .fixed-controls{display:flex;gap:8px;align-items:center}
    .circle{width:44px;height:44px;border-radius:999px;display:grid;place-items:center;border:1px solid rgba(255,255,255,.06);cursor:pointer}
    .circle.playing{border-color:var(--gold);color:var(--gold)}

    /* ---------------- fullscreen player (Spotify-like) ---------------- */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.75);z-index:200}
    .sheet{width:min(980px,96vw);background:#0a0a0a;border-radius:16px;padding:18px;border:1px solid rgba(255,255,255,.04);display:flex;gap:18px;align-items:flex-start}
    .full-cover{width:320px;height:320px;object-fit:cover;border-radius:10px;flex-shrink:0}
    .full-meta{flex:1;min-width:0}
    .full-title{font-size:28px;font-weight:900;color:var(--gold)}
    .full-artist{color:var(--muted);margin-top:6px}
    .timeline{width:100%;margin-top:14px}
    .time-row{display:flex;justify-content:space-between;color:var(--muted);font-size:13px;margin-top:6px}

    footer{margin-top:12px;padding:12px;text-align:center;color:#888;font-size:13px}

    @media(max-width:720px){
      main{padding-bottom:calc(var(--player-height) + 42px)}
      .sheet{flex-direction:column;align-items:center}
      .full-cover{width:86vw;height:86vw}
    }
  </style>
</head>
<body>
  <!-- HEADER -->
  <header>
    <div class="logo">CITÉ MIAMI</div>
    <nav class="nav" aria-label="Main">
      <button class="active" data-target="home">Home</button>
      <button data-target="songs">Songs</button>
      <button data-target="artists">Artists</button>
      <button data-target="albums">Albums</button>
      <button data-target="about">About</button>
    </nav>
  </header>

  <!-- MAIN CONTENT -->
  <main>
    <!-- HOME / feed -->
    <section id="home" class="page">
      <h2 style="color:var(--gold)">Feed</h2>
      <div id="feed" class="feed" aria-live="polite"></div>
    </section>

    <!-- SONGS -->
    <section id="songs" class="page" style="display:none">
      <h2 style="color:var(--gold)">Songs</h2>
      <div class="search-row">
        <input id="searchInput" type="search" placeholder="Search songs or artists..." />
        <button id="resetSearch" class="small-btn">Reset</button>
      </div>
      <div id="songsGrid" class="songs-grid" aria-live="polite"></div>
    </section>

    <!-- ARTISTS -->
    <section id="artists" class="page" style="display:none">
      <h2 style="color:var(--gold)">Artists</h2>
      <div id="artistsGrid" class="artist-grid"></div>
    </section>

    <!-- ALBUMS -->
    <section id="albums" class="page" style="display:none">
      <h2 style="color:var(--gold)">Albums</h2>
      <div id="albumsGrid" class="album-grid"></div>
    </section>

    <!-- ABOUT -->
    <section id="about" class="page" style="display:none">
      <h2 style="color:var(--gold)">About</h2>
      <div class="card">
        <p style="color:var(--muted)">Replace the GITHUB_ASSETS_BASE variable inside the script with your raw GitHub assets base URL. Put MP3 and images there.</p>
      </div>
    </section>
  </main>

  <!-- FIXED MINI-PLAYER (always visible, does NOT scroll) -->
  <div id="fixedPlayer" class="fixed-player" role="region" aria-label="Mini player">
    <img id="fixedCover" class="fixed-cover" src="" alt="cover">
    <div class="fixed-info">
      <div id="fixedTitle" class="fixed-title">—</div>
      <div id="fixedArtist" class="fixed-artist">—</div>
      <div style="display:flex;gap:12px;align-items:center;margin-top:6px">
        <div style="color:var(--muted);font-size:13px">Plays: <strong id="fixedPlays">0</strong></div>
        <div style="color:var(--muted);font-size:13px">Likes: <strong id="fixedLikes">0</strong></div>
      </div>
    </div>
    <div class="fixed-controls">
      <div id="prevBtn" class="circle" title="Previous">⏮</div>
      <div id="playBtn" class="circle" title="Play">▶</div>
      <div id="nextBtn" class="circle" title="Next">⏭</div>
      <button id="expandBtn" class="small-btn" title="Open full player">Open</button>
    </div>
  </div>

  <footer></footer>

  <!-- FULLSCREEN (Spotify-like) PLAYER -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="sheet" role="dialog" aria-label="Full player">
      <img id="fullCover" class="full-cover" src="" alt="cover">
      <div class="full-meta">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div id="fullTitle" class="full-title">—</div>
            <div id="fullArtist" class="full-artist">—</div>
            <div id="fullAlbum" style="color:var(--muted);margin-top:6px">—</div>
          </div>
          <div>
            <button id="likeFull" class="small-btn">❤ Like</button>
            <button id="closeModal" class="small-btn">Close</button>
          </div>
        </div>

        <div style="margin-top:18px">
          <div style="display:flex;gap:12px;align-items:center">
            <div id="fullPrev" class="circle">⏮</div>
            <div id="fullPlay" class="circle">▶</div>
            <div id="fullNext" class="circle">⏭</div>
            <div style="margin-left:12px;color:var(--muted)">Plays: <strong id="fullPlays">0</strong> • Likes: <strong id="fullLikes">0</strong></div>
          </div>

          <div class="timeline">
            <input id="fullProgress" type="range" min="0" max="100" value="0" style="width:100%" />
            <div class="time-row"><span id="fullCurrent">0:00</span><span id="fullTotal">0:00</span></div>
          </div>
        </div>

        <div style="margin-top:16px;color:var(--muted)">
          <small>Use the controls or timeline to navigate the track.</small>
        </div>
      </div>
    </div>
  </div>

  <!-- AUDIO ENGINE -->
  <audio id="audio" preload="metadata" crossorigin="anonymous"></audio>

  <!-- ===========================
       APPLICATION SCRIPT
       =========================== -->
  <script>
  /*************************************************************************
   *  IMPORTANT: Replace GITHUB_ASSETS_BASE with your GitHub raw base URL
   *  Example: "https://raw.githubusercontent.com/USERNAME/CITEMIAMI/main/assets/"
   *  Then upload all your images and mp3 files to that folder in the repo.
   *************************************************************************/
  const GITHUB_ASSETS_BASE = "https://raw.githubusercontent.com/nottiffoficiel/CITEMIAMI/refs/heads/Assets/"; // <-- change this

  /*************************************************************************
   * DATA - Edit filenames to match your assets inside the GitHub folder
   * Each song has: id, title, artist (display), artistId, albumId, cover, src, youtube (optional)
   *************************************************************************/
  const ARTISTS = [
    { id:'nottiff', name:'Nottiff', avatar: GITHUB_ASSETS_BASE + 'ntf1.jpeg', genre:'Rnb / Trap', bio:'Bio Nottiff...' },
    { id:'czone', name:'CZ One', avatar: GITHUB_ASSETS_BASE + 'cz.jpeg', genre:'Rap Swahili / Trap', bio:'Bio CZ One...' },
    { id:'dezball', name:'Dezball', avatar: GITHUB_ASSETS_BASE + 'dz.jpeg', genre:'Afro-urban', bio:'Bio Dezball...' }
  ];

  const ALBUMS = [
    { id:'a1', title:'REALITIES', cover: GITHUB_ASSETS_BASE + 'realities_pic.jpeg', year:2025 },
    { id:'a2', title:'CITY VIBES', cover: GITHUB_ASSETS_BASE + 'album_cityvibes.jpeg', year:2024 }
  ];

  const SONGS = [
    { id:'s1', title:'Fashi Ya Beyi', artist:'Nottiff', artistId:'nottiff', albumId:'a1', cover: GITHUB_ASSETS_BASE + 'realities_pic.jpeg', src: GITHUB_ASSETS_BASE + 'FASHI Ya BEYI.mp3', youtube: 'https://youtu.be/jkRwSHRuNZM?si=wvwN-yhiknkfxYts' },
    { id:'s2', title:'Winners', artist:'Cité Miami', artistId:'czone', albumId:'a2', cover: GITHUB_ASSETS_BASE + 'winners_pic.jpeg', src: GITHUB_ASSETS_BASE + 'winners.mp3', youtube: 'https://www.youtube.com/watch?v=YOUTUBE_ID_2' },
    { id:'s3', title:'Volonté', artist:'Dezball', artistId:'dezball', albumId:'a2', cover: GITHUB_ASSETS_BASE + 'volonte_pic.jpeg', src: GITHUB_ASSETS_BASE + 'volonté.mp3', youtube: '' },
    {id:"s4", title:"Maisha Polepole", artist:"JS3", artistId:"js3", albumId:"Single", cover: GITHUB_ASSETS_BASE + "miasha_polepole_pic.jpg", src: GITHUB_ASSETS_BASE + "JS3_Maisha Polepole_Ft_Nottiff.mp3"}
  ];

  /*************************************************************************
   * Local state & storage keys - local only (no backend)
   * - counts persist in localStorage so the user sees updates across reloads
   *************************************************************************/
  const PLAY_COUNTS_KEY = 'cm_play_counts_local_v1';
  const LIKES_KEY = 'cm_likes_local_v1';

  function loadCounts(){ try{ return JSON.parse(localStorage.getItem(PLAY_COUNTS_KEY)||'{}'); }catch(e){return{};} }
  function saveCounts(obj){ localStorage.setItem(PLAY_COUNTS_KEY, JSON.stringify(obj)); }
  function loadLikes(){ try{ return JSON.parse(localStorage.getItem(LIKES_KEY)||'{}'); }catch(e){return{};} }
  function saveLikes(obj){ localStorage.setItem(LIKES_KEY, JSON.stringify(obj)); }

  let playCounts = loadCounts();
  let likes = loadLikes();

  /*************************************************************************
   * DOM refs
   *************************************************************************/
  const refs = {
    // pages
    pages: {
      home: document.getElementById('home'),
      songs: document.getElementById('songs'),
      artists: document.getElementById('artists'),
      albums: document.getElementById('albums'),
      about: document.getElementById('about')
    },
    feed: document.getElementById('feed'),
    songsGrid: document.getElementById('songsGrid'),
    artistsGrid: document.getElementById('artistsGrid'),
    albumsGrid: document.getElementById('albumsGrid'),
    searchInput: document.getElementById('searchInput'),
    resetSearch: document.getElementById('resetSearch'),
    // fixed player
    fixedPlayer: document.getElementById('fixedPlayer'),
    fixedCover: document.getElementById('fixedCover'),
    fixedTitle: document.getElementById('fixedTitle'),
    fixedArtist: document.getElementById('fixedArtist'),
    fixedPlays: document.getElementById('fixedPlays'),
    fixedLikes: document.getElementById('fixedLikes'),
    playBtn: document.getElementById('playBtn'),
    prevBtn: document.getElementById('prevBtn'),
    nextBtn: document.getElementById('nextBtn'),
    expandBtn: document.getElementById('expandBtn'),
    // modal
    modal: document.getElementById('modal'),
    fullCover: document.getElementById('fullCover'),
    fullTitle: document.getElementById('fullTitle'),
    fullArtist: document.getElementById('fullArtist'),
    fullAlbum: document.getElementById('fullAlbum'),
    fullPlays: document.getElementById('fullPlays'),
    fullLikes: document.getElementById('fullLikes'),
    fullPlay: document.getElementById('fullPlay'),
    fullPrev: document.getElementById('fullPrev'),
    fullNext: document.getElementById('fullNext'),
    fullProgress: document.getElementById('fullProgress'),
    fullCurrent: document.getElementById('fullCurrent'),
    fullTotal: document.getElementById('fullTotal'),
    likeFull: document.getElementById('likeFull'),
    closeModal: document.getElementById('closeModal'),
    audio: document.getElementById('audio')
  };

  // nav buttons
  const navButtons = Array.from(document.querySelectorAll('.nav button'));

  /*************************************************************************
   * NAV: show/hide pages
   *************************************************************************/
  function showPage(name){
    Object.values(refs.pages).forEach(p => { if(p) p.style.display = 'none'; });
    const p = refs.pages[name];
    if(p) p.style.display = 'block';
    navButtons.forEach(b => b.classList.toggle('active', b.dataset.target === name));
    // re-render some content when switching
    if(name === 'home') renderFeed();
    if(name === 'songs') renderSongs();
    if(name === 'artists') renderArtists();
    if(name === 'albums') renderAlbums();
  }
  navButtons.forEach(b => b.addEventListener('click', ()=> showPage(b.dataset.target)));

  /*************************************************************************
   * FEED (automatic update)
   *************************************************************************/
  function getLatestSong(){ return SONGS[SONGS.length - 1]; }
  function getMostPlayedSong(){
    const entries = Object.entries(playCounts);
    if(entries.length === 0) return SONGS[0];
    let bestId = entries.sort((a,b)=> b[1]-a[1])[0][0];
    return SONGS.find(s=>s.id === bestId) || SONGS[0];
  }

  function makeTile({title, subtitle, img, onclick}){
    const el = document.createElement('div');
    el.className = 'tile';
    el.innerHTML = `<img class="thumb" src="${img}" alt="${title}"><h4>${title}</h4><p>${subtitle}</p><div class="meta-row"><div class="pill">Cité Miami</div><div class="pill">Now</div></div>`;
    if(onclick) el.addEventListener('click', onclick);
    // hover effect - scale thumb
    el.addEventListener('mouseenter', ()=> el.querySelector('.thumb').style.transform = 'scale(1.03)');
    el.addEventListener('mouseleave', ()=> el.querySelector('.thumb').style.transform = 'scale(1)');
    return el;
  }

  function renderFeed(){
    refs.feed.innerHTML = '';
    const latest = getLatestSong();
    refs.feed.appendChild(makeTile({
      title: 'Latest — ' + latest.title,
      subtitle: latest.artist,
      img: latest.cover,
      onclick: ()=> playById(latest.id)
    }));

    // new clip: first with youtube
    const clip = SONGS.find(s => s.youtube && s.youtube.trim().length > 5);
    if(clip){
      refs.feed.appendChild(makeTile({
        title: 'New Clip',
        subtitle: `${clip.title} — Watch on YouTube`,
        img: clip.cover,
        onclick: ()=> window.open(clip.youtube, '_blank')
      }));
    }

    const fav = getMostPlayedSong();
    refs.feed.appendChild(makeTile({
      title: 'Most Played',
      subtitle: `${fav.title} • ${fav.artist}`,
      img: fav.cover,
      onclick: ()=> playById(fav.id)
    }));

    // random discovery
    const rand = SONGS[Math.floor(Math.random()*SONGS.length)];
    refs.feed.appendChild(makeTile({
      title: 'Discover',
      subtitle: `${rand.title} • ${rand.artist}`,
      img: rand.cover,
      onclick: ()=> playById(rand.id)
    }));
  }

  // rotate feed every 8s (rebuild feed)
  let feedInterval = null;
  function startFeedRotation(){ if(feedInterval) clearInterval(feedInterval); feedInterval = setInterval(renderFeed, 8000); }
  function stopFeedRotation(){ if(feedInterval) clearInterval(feedInterval); feedInterval = null; }

  /*************************************************************************
   * RENDER SONGS / ARTISTS / ALBUMS
   *************************************************************************/
  function renderSongs(filter=''){
    refs.songsGrid.innerHTML = '';
    const q = (filter || '').trim().toLowerCase();
    SONGS.filter(s => {
      if(!q) return true;
      return s.title.toLowerCase().includes(q) || s.artist.toLowerCase().includes(q);
    }).forEach(s => {
      const div = document.createElement('div'); div.className = 'song-tile';
      const pc = playCounts[s.id] || 0;
      const lk = likes[s.id] || 0;
      div.innerHTML = `
        <img class="song-cover" src="${s.cover}" alt="${s.title}">
        <div class="song-meta">
          <div class="song-title">${s.title}</div>
          <div class="song-artist">${s.artist}</div>
          <div style="margin-top:8px;color:var(--muted);font-size:13px">
            Plays: <strong>${pc}</strong> • Likes: <strong>${lk}</strong>
            &nbsp; • &nbsp;
            <button class="small-btn" data-play="${s.id}">Play</button>
            &nbsp; • &nbsp;
            <button class="small-btn" data-profile="${s.artistId}">Artist</button>
            &nbsp; • &nbsp;
            <button class="small-btn" data-album="${s.albumId}">Album</button>
          </div>
        </div>
      `;
      refs.songsGrid.appendChild(div);
    });
  }

  function renderArtists(){
    refs.artistsGrid.innerHTML = '';
    ARTISTS.forEach(a => {
      const card = document.createElement('div'); card.className='card';
      card.innerHTML = `<img class="avatar" src="${a.avatar}" alt="${a.name}"><h3 style="margin:8px 0 4px">${a.name}</h3><div style="color:var(--muted)">${a.genre}</div>
        <div style="margin-top:8px"><button class="small-btn" data-open="${a.id}">Open profile</button> <button class="small-btn" data-playartist="${a.id}">Play</button></div>`;
      refs.artistsGrid.appendChild(card);
    });
  }

  function renderAlbums(){
    refs.albumsGrid.innerHTML = '';
    ALBUMS.forEach(al => {
      const card = document.createElement('div'); card.className='card';
      card.innerHTML = `<img class="avatar" src="${al.cover}" alt="${al.title}"><h3 style="margin:8px 0 4px">${al.title}</h3><div style="color:var(--muted)">${al.year}</div>
        <div style="margin-top:8px"><button class="small-btn" data-albumopen="${al.id}">Open album</button></div>`;
      refs.albumsGrid.appendChild(card);
    });
  }

  /*************************************************************************
   * ARTIST PROFILE (dynamic)
   *************************************************************************/
  function openArtist(artistId){
    const art = ARTISTS.find(a=>a.id===artistId);
    if(!art) return;
    // create a simple artist page dynamically to show songs
    const sectionId = 'artistView';
    let section = document.getElementById(sectionId);
    if(section) section.remove();
    section = document.createElement('section');
    section.id = sectionId; section.className = 'page';
    section.innerHTML = `
      <button class="small-btn" id="backToArtists" style="margin-bottom:10px">← Back</button>
      <div class="card" style="display:flex;gap:12px;align-items:center">
        <img src="${art.avatar}" style="width:160px;height:160px;object-fit:cover;border-radius:10px" alt="${art.name}">
        <div><h2 style="margin:0;color:var(--gold)">${art.name}</h2><div style="color:var(--muted);margin-top:6px">${art.genre}</div>
        <p style="color:#ddd;margin-top:8px">${art.bio}</p></div>
      </div>
      <h3 style="color:var(--gold);margin-top:12px">Tracks</h3>
      <div id="artistTracks" class="songs-grid"></div>
    `;
    document.querySelector('main').insertBefore(section, document.getElementById('fixedPlayer'));
    // fill songs
    const wrap = section.querySelector('#artistTracks');
    SONGS.filter(s=>s.artistId===artistId).forEach(s=>{
      const div = document.createElement('div'); div.className='song-tile';
      const pc = playCounts[s.id]||0, lk = likes[s.id]||0;
      div.innerHTML = `<img class="song-cover" src="${s.cover}"><div class="song-meta"><div class="song-title">${s.title}</div>
        <div style="margin-top:8px;color:var(--muted)">Plays: <strong>${pc}</strong> • Likes: <strong>${lk}</strong>
        &nbsp; • &nbsp;<button class="small-btn" data-play="${s.id}">Play</button></div></div>`;
      wrap.appendChild(div);
    });
    // back handler
    section.querySelector('#backToArtists').addEventListener('click', ()=> { section.remove(); showPage('artists'); });
    showPage(sectionId);
  }

  /*************************************************************************
   * ALBUM VIEW (dynamic)
   *************************************************************************/
  function openAlbum(albumId){
    const al = ALBUMS.find(a=>a.id===albumId);
    if(!al) return;
    const sectionId = 'albumView';
    let section = document.getElementById(sectionId);
    if(section) section.remove();
    section = document.createElement('section'); section.id = sectionId; section.className = 'page';
    section.innerHTML = `
      <button class="small-btn" id="backToAlbums" style="margin-bottom:10px">← Back</button>
      <div class="card" style="display:flex;gap:12px;align-items:center">
        <img src="${al.cover}" style="width:160px;height:160px;object-fit:cover;border-radius:10px" alt="${al.title}">
        <div><h2 style="margin:0;color:var(--gold)">${al.title}</h2><div style="color:var(--muted);margin-top:6px">${al.year}</div></div>
      </div>
      <h3 style="color:var(--gold);margin-top:12px">Tracks</h3>
      <div id="albumTracks" class="songs-grid"></div>
    `;
    document.querySelector('main').insertBefore(section, document.getElementById('fixedPlayer'));
    const wrap = section.querySelector('#albumTracks');
    SONGS.filter(s=>s.albumId===albumId).forEach(s=>{
      const div = document.createElement('div'); div.className='song-tile';
      const pc = playCounts[s.id]||0, lk = likes[s.id]||0;
      div.innerHTML = `<img class="song-cover" src="${s.cover}"><div class="song-meta"><div class="song-title">${s.title}</div>
        <div style="margin-top:8px;color:var(--muted)">Plays: <strong>${pc}</strong> • Likes: <strong>${lk}</strong>
        &nbsp; • &nbsp;<button class="small-btn" data-play="${s.id}">Play</button></div></div>`;
      wrap.appendChild(div);
    });
    section.querySelector('#backToAlbums').addEventListener('click', ()=> { section.remove(); showPage('albums'); });
    showPage(sectionId);
  }

  /*************************************************************************
   * PLAYBACK: core functions - play by index or id, update UI & counts
   *************************************************************************/
  function setFixedPlayerFor(song){
    refs.fixedCover.src = song.cover;
    refs.fixedTitle.textContent = song.title;
    refs.fixedArtist.textContent = song.artist;
    refs.fixedPlays.textContent = (playCounts[song.id] || 0);
    refs.fixedLikes.textContent = (likes[song.id] || 0);
    // full modal
    refs.fullCover.src = song.cover;
    refs.fullTitle.textContent = song.title;
    refs.fullArtist.textContent = song.artist;
    const album = ALBUMS.find(a=>a.id===song.albumId);
    refs.fullAlbum.textContent = album ? `${album.title} • ${album.year}` : '';
    refs.fullPlays.textContent = (playCounts[song.id] || 0);
    refs.fullLikes.textContent = (likes[song.id] || 0);
  }

  async function playIndex(i){
    if(i<0 || i>=SONGS.length) return;
    currentIndex = i;
    const track = SONGS[i];
    // set src and play
    refs.audio.src = track.src;
    try{
      await refs.audio.play();
      isPlaying = true;
      setFixedPlayerFor(track);
      // increment play count immediately (live)
      playCounts[track.id] = (playCounts[track.id]||0) + 1;
      saveCounts(playCounts);
      // reflect in UI
      refs.fixedPlays.textContent = playCounts[track.id];
      refs.fullPlays.textContent = playCounts[track.id];
      // update songs list where play counts displayed
      renderSongs(refs.searchInput.value || '');
    }catch(err){
      console.warn('Play failed (CORS or network):', err);
    }
  }

  function playById(id){
    const idx = SONGS.findIndex(s=>s.id === id);
    if(idx >= 0) playIndex(idx);
  }

  function prevTrack(){ playIndex((currentIndex - 1 + SONGS.length) % SONGS.length); }
  function nextTrack(){ playIndex((currentIndex + 1) % SONGS.length); }

  // audio events: progress & ended
  refs.audio.addEventListener('timeupdate', ()=>{
    if(isNaN(refs.audio.duration)) return;
    const cur = Math.floor(refs.audio.currentTime);
    const dur = Math.floor(refs.audio.duration);
    refs.fullProgress.max = dur;
    refs.fullProgress.value = cur;
    refs.fullCurrent.textContent = formatTime(cur);
    refs.fullTotal.textContent = formatTime(dur);
  });

  refs.audio.addEventListener('play', ()=> { isPlaying = true; refs.playBtn.classList.add('playing'); refs.playBtn.textContent = '⏸'; refs.fullPlay.textContent = '⏸'; });
  refs.audio.addEventListener('pause', ()=> { isPlaying = false; refs.playBtn.classList.remove('playing'); refs.playBtn.textContent = '▶'; refs.fullPlay.textContent = '▶'; });
  refs.audio.addEventListener('ended', ()=> { nextTrack(); });

  // controls
  refs.playBtn.addEventListener('click', ()=> { if(refs.audio.paused) refs.audio.play().catch(()=>{}); else refs.audio.pause(); });
  refs.prevBtn.addEventListener('click', prevTrack);
  refs.nextBtn.addEventListener('click', nextTrack);
  refs.fullPrev.addEventListener('click', prevTrack);
  refs.fullNext.addEventListener('click', nextTrack);
  refs.fullPlay.addEventListener('click', ()=> { if(refs.audio.paused) refs.audio.play().catch(()=>{}); else refs.audio.pause(); });

  // progress scrubbing
  refs.fullProgress.addEventListener('input', (e)=> { refs.audio.currentTime = Number(e.target.value || 0); });

  // like handling
  function likeCurrent(){
    const track = SONGS[currentIndex];
    if(!track) return;
    likes[track.id] = (likes[track.id]||0) + 1;
    saveLikes(likes);
    refs.fixedLikes.textContent = likes[track.id];
    refs.fullLikes.textContent = likes[track.id];
    // update lists
    renderSongs(refs.searchInput.value || '');
  }
  document.getElementById('likeFull').addEventListener('click', likeCurrent);

  /*************************************************************************
   * Fullscreen modal handlers
   *************************************************************************/
  document.getElementById('expandBtn').addEventListener('click', ()=>{
    refs.modal.style.display = 'flex';
    refs.modal.setAttribute('aria-hidden','false');
    // update current song data in modal
    const track = SONGS[currentIndex] || SONGS[0];
    setFixedPlayerFor(track);
    // set full progress if audio loaded
    if(!isNaN(refs.audio.duration)) { refs.fullProgress.max = Math.floor(refs.audio.duration); refs.fullProgress.value = Math.floor(refs.audio.currentTime); }
  });
  refs.closeModal.addEventListener('click', ()=> { refs.modal.style.display = 'none'; refs.modal.setAttribute('aria-hidden','true'); });

  /*************************************************************************
   * Delegated clicks for dynamic elements (play buttons, profiles, album open)
   *************************************************************************/
  document.addEventListener('click', (e) => {
    const playBtn = e.target.closest('[data-play]');
    if(playBtn){ playById(playBtn.dataset.play); return; }
    const prof = e.target.closest('[data-profile]');
    if(prof){ openArtist(prof.dataset.profile); return; }
    const albumBtn = e.target.closest('[data-album]');
    if(albumBtn){ openAlbum(albumBtn.dataset.album); return; }
    const openArtistBtn = e.target.closest('[data-open]');
    if(openArtistBtn){ openArtist(openArtistBtn.dataset.open); return; }
    const playArtist = e.target.closest('[data-playartist]');
    if(playArtist){ const t = SONGS.find(s=>s.artistId === playArtist.dataset.playartist); if(t) playById(t.id); return; }
    const albumOpen = e.target.closest('[data-albumopen]');
    if(albumOpen){ openAlbum(albumOpen.dataset.albumopen); return; }
    const plike = e.target.closest('#btnLike');
    if(plike){ likeCurrent(); return; }
  });

  /*************************************************************************
   * UTIL helpers
   *************************************************************************/
  function formatTime(s){ if(!s || isNaN(s)) return '0:00'; const m = Math.floor(s/60); const sec = String(Math.floor(s%60)).padStart(2,'0'); return `${m}:${sec}`; }

  /*************************************************************************
   * SEARCH
   *************************************************************************/
  if(refs.searchInput){
    refs.searchInput.addEventListener('input', (e)=> renderSongs(e.target.value));
    refs.resetSearch.addEventListener('click', ()=> { refs.searchInput.value=''; renderSongs(); });
  }

  /*************************************************************************
   * INIT app
   *************************************************************************/
  function init(){
    renderFeed();
    renderSongs();
    renderArtists();
    renderAlbums();
    showPage('home');
    startFeedRotation();
    // prefill fixed player with first track
    if(SONGS.length > 0){
      currentIndex = 0;
      setFixedPlayerFor(SONGS[0]);
      refs.fixedPlayer.style.display = 'flex';
    }
  }

  document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>