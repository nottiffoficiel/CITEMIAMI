<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cité Miami — App</title>

  <!-- ========================
       STYLES (tout en un)
       Remplace les couleurs/polices si tu veux, mais évite les imports externes pour WebViewer
       ========================= -->
  <style>
    :root{
      --bg:#0b0b0b;
      --panel:#121212;
      --panel-2:#161616;
      --muted:#9a9a9a;
      --gold:#d4af37;
      --accent:#ff8a00;
      --glass: rgba(255,255,255,0.04);
      --radius:14px;
      --maxw:1040px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#070707,#0d0d0d);color:#eee;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
    a{color:inherit}
    header{position:sticky;top:0;z-index:80;background:linear-gradient(90deg,#0f0f0f, #121212);border-bottom:1px solid rgba(255,215,0,.06);padding:14px 12px;display:flex;align-items:center;gap:12px}
    .logo{font-weight:800;color:var(--gold);letter-spacing:.6px;font-size:18px}
    .nav{margin-left:auto;display:flex;gap:8px}
    .nav button{background:transparent;border:1px solid rgba(255,255,255,.04);padding:8px 10px;border-radius:999px;color:#ddd;cursor:pointer;font-weight:700}
    .nav button.active{border-color:var(--gold);color:var(--gold);box-shadow:0 6px 22px rgba(212,175,55,.06)}
    main{max-width:var(--maxw);margin:18px auto;padding:0 14px 90px}
    /* ---------- FEED (Accueil) ---------- */
    .feed{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px}
    .tile{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;gap:8px;cursor:pointer;transition:transform .14s, box-shadow .14s}
    .tile:hover{transform:translateY(-6px);box-shadow:0 18px 40px rgba(0,0,0,.6)}
    .tile .thumb{width:100%;height:140px;border-radius:10px;object-fit:cover;background:#222;display:block}
    .tile h4{margin:0;font-size:16px;color:var(--gold);letter-spacing:.3px}
    .tile p{margin:0;color:var(--muted);font-size:13px}
    .tile .meta{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
    .pill{background:var(--glass);padding:6px 8px;border-radius:999px;font-size:12px;border:1px solid rgba(255,255,255,.03)}
    /* ---------- SONG LIST / TUILES FINES ---------- */
    .search-row{display:flex;gap:8px;align-items:center;margin-bottom:12px}
    .search-row input{flex:1;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.05);background:transparent;color:#fff}
    .songs-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:10px}
    .song-tile{display:flex;gap:10px;align-items:center;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.03);background:linear-gradient(180deg,#0f0f0f,#131313)}
    .song-cover{width:64px;height:64px;border-radius:8px;object-fit:cover}
    .song-meta{min-width:0;overflow:hidden}
    .song-title{font-weight:800;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .song-artist{color:var(--muted);font-size:13px;margin-top:3px}
    .btn-small{background:transparent;border:1px solid rgba(255,255,255,.04);padding:8px;border-radius:8px;cursor:pointer}
    /* ---------- ARTIST PROFILE ---------- */
    .artist-page{display:none}
    .artist-hero{display:flex;gap:16px;align-items:center;background:linear-gradient(180deg, rgba(212,175,55,.03), transparent);padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,.03)}
    .artist-avatar{width:160px;height:160px;border-radius:14px;object-fit:cover;flex-shrink:0}
    .artist-bio{flex:1}
    .socials{display:flex;gap:8px;margin-top:8px}
    .socials a{padding:6px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.03);background:transparent;text-decoration:none;color:#ddd;font-weight:700}
    /* ---------- MINI PLAYER (plus beau) ---------- */
    .mini-player{position:fixed;left:12px;right:12px;bottom:12px;z-index:120;background:linear-gradient(90deg,#0f0f0f,#151515);border-radius:16px;padding:10px 12px;display:flex;align-items:center;gap:12px;border:1px solid rgba(255,255,255,.04);box-shadow:0 10px 40px rgba(0,0,0,.6)}
    .mini-left{display:flex;gap:10px;align-items:center;min-width:0}
    .mini-cover{width:64px;height:64px;border-radius:10px;object-fit:cover}
    .mini-info{min-width:0}
    .mini-title{font-weight:800;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .mini-sub{color:var(--muted);font-size:13px;margin-top:4px}
    .mini-controls{display:flex;align-items:center;gap:8px;margin-left:auto}
    .round{width:44px;height:44px;border-radius:999px;display:grid;place-items:center;cursor:pointer;border:1px solid rgba(255,255,255,.03)}
    .round.playing{box-shadow:0 8px 30px rgba(212,175,55,.08);border-color:var(--gold);color:var(--gold)}
    .progress-wrap{width:240px;display:flex;flex-direction:column;gap:6px;margin-left:12px}
    input[type="range"]{width:100%}
    .time-row{display:flex;justify-content:space-between;font-size:12px;color:var(--muted)}
    /* responsive */
    @media (max-width:720px){
      .artist-hero{flex-direction:column;align-items:flex-start}
      .mini-player{flex-direction:column;align-items:flex-start;gap:8px;padding:12px}
      .progress-wrap{width:100%}
    }
  </style>
</head>
<body>

  <!-- =========================
       HEADER / NAV
       ========================= -->
  <header>
    <div class="logo">CITÉ MIAMI</div>
    <nav class="nav" role="navigation" aria-label="Sections">
      <button class="active" data-target="home">Accueil</button>
      <button data-target="chansons">Chansons</button>
      <button data-target="artistes">Artistes</button>
      <button data-target="apropos">À propos</button>
    </nav>
  </header>

  <main>
    <!-- =========================
         ACCUEIL — FEED (Tiles géométriques alignées)
         ========================= -->
    <section id="home" class="page active">
      <h2 style="margin:6px 0 14px;color:var(--gold)">Feed — Cité Miami</h2>
      <div id="feed" class="feed">
        <!-- Tiles générées dynamiquement -->
      </div>
    </section>

    <!-- =========================
         CHANSONS — Recherche + grid
         ========================= -->
    <section id="chansons" class="page" style="display:none">
      <div class="search-row">
        <input id="search" placeholder="Rechercher chanson / artiste ..." />
        <button class="btn-small" id="btn-reset">Reset</button>
      </div>
      <div id="songsGrid" class="songs-grid"></div>
    </section>

    <!-- =========================
         ARTISTES — liste + profil dynamique
         ========================= -->
    <section id="artistes" class="page" style="display:none">
      <h2 style="color:var(--gold);margin-top:0">Artistes</h2>
      <div id="artistsList" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px"></div>
    </section>

    <!-- Artist profile page (single-page dynamic view) -->
    <section id="artistProfile" class="artist-page" aria-hidden="true" style="margin-top:10px">
      <button class="btn-small" id="backToArtists" style="margin-bottom:10px">← Retour</button>
      <div class="artist-hero">
        <img id="artistAvatar" class="artist-avatar" src="" alt="avatar" />
        <div class="artist-bio">
          <h2 id="artistName" style="margin:0;color:var(--gold)"></h2>
          <div id="artistGenre" class="muted" style="margin-top:6px"></div>
          <p id="artistFullBio" style="margin-top:10px;color:#ddd"></p>
          <div class="socials" id="artistSocials"></div>
        </div>
      </div>

      <h3 style="margin-top:14px;color:var(--gold)">Chansons de l'artiste</h3>
      <div id="artistSongs" class="songs-grid"></div>
    </section>

    <!-- =========================
         À PROPOS
         ========================= -->
    <section id="apropos" class="page" style="display:none">
      <h2 style="color:var(--gold)">À propos</h2>
      <div style="background:var(--panel);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,.03)">
        <p class="muted">Maquette web pour WebViewer — Cité Miami. Conçue par AmaliCorp. Remplace les assets et IDs Google Drive par les tiens (voir commentaires dans le code).</p>
      </div>
    </section>
  </main>

  <!-- =========================
       MINI PLAYER — UI amélioré + tracking
       ========================= -->
  <div class="mini-player" id="miniPlayer" style="display:none">
    <div class="mini-left">
      <img id="miniCover" class="mini-cover" src="" alt="cover" />
      <div class="mini-info">
        <div class="mini-title" id="miniTitle">—</div>
        <div class="mini-sub" id="miniArtist">—</div>
      </div>

      <div class="progress-wrap" style="margin-left:12px">
        <input id="miniProgress" type="range" min="0" max="100" value="0" />
        <div class="time-row"><span id="timeCurr">0:00</span><span id="timeTotal">0:00</span></div>
      </div>
    </div>

    <div class="mini-controls" role="group" aria-label="Transport">
      <div class="round" id="btnPrev" title="Précédent">⏮</div>
      <div class="round" id="btnPlay" title="Lecture / Pause">▶</div>
      <div class="round" id="btnNext" title="Suivant">⏭</div>
      <div style="display:flex;flex-direction:column;align-items:flex-end;gap:6px">
        <div style="font-size:12px;color:var(--muted)">Volume</div>
        <input id="miniVol" type="range" min="0" max="1" step="0.01" value="1" style="width:110px" />
      </div>
    </div>
  </div>

  <!-- =========================
       AUDIO (player engine)
       ========================= -->
  <audio id="audio" preload="metadata" crossorigin="anonymous"></audio>

  <!-- =========================
       JAVASCRIPT — logique
       - COMMENT: remplace les IDs Google Drive (ID_GOOGLE_DRIVE_x) par les tiens.
       - Les images peuvent être stockées dans le repo (recommande: /assets/).
       - Les "plays" sont suivis en localStorage (démo). Pour backend, envoie POST à ton serveur.
       ========================= -->
  <script>
  /* ======================================================
     ================ EDIT HERE (PLAYLIST / ARTISTS) ========
     ======================================================
     - Pour les MP3 utilisez des liens direct download :
       Google Drive format:
         https://drive.google.com/uc?export=download&id=ID_GOOGLE_DRIVE
       (comment dans README: uploader et rendre "visible à tous").
     - Remplace COVER avec le nom de fichier image présent dans le repo.
     - artistId relie les chansons à la page profil.
  */
  const ARTISTS = [
    {
      id: 'nottiff',
      name: 'Nottiff',
      avatar: 'https://drive.google.com/file/d/15zeX9o1i0TLUx8FTjLCAa893NrHrKKR0/view?usp=drivesdk', // => replace by image file in repo
      genre: 'Rnb / Trap',
      bio: `Nottiff — auteur, producteur et performeur. Inspiré par la rue, il transforme la réalité en mélodies. REALITIES (EP) en préparation.`,
      socials: {
        tiktok: 'https://tiktok.com/@nottiff',
        instagram: 'https://instagram.com/nottiff',
        youtube: 'https://youtube.com/@nottiff'
      }
    },
    {
      id: 'czone',
      name: 'CZ One',
      avatar: 'czone3.jpeg',
      genre: 'Rap Swahili / Trap',
      bio: `CZ One, roi de la cité. Flow Swahili puissant, punchlines et énergie.`,
      socials: { instagram:'#', tiktok:'#', youtube:'#' }
    },
    {
      id: 'dezball',
      name: 'Dezball',
      avatar: 'dz.jpeg',
      genre: 'Afro-urban / Trap',
      bio: `Dezball mélange afro et trap — vibes pour la route.`,
      socials: { instagram:'#', tiktok:'#', youtube:'#' }
    }
  ];

  // PLAYLIST — remplace les ID_GOOGLE_DRIVE_x par les tiens
  const PLAYLIST = [
    {
      id: 'track-1',
      title: 'Fashi Ya Beyi',
      artist: 'Nottiff',
      artistId: 'nottiff',
      cover: 'czone2.jpeg',
      // =====> EDIT: paste your Google Drive ID (file ID) between quotes below
      // Example Drive public direct link:
      // src: "https://drive.google.com/uc?export=download&id=1a2B3cDeFgHiJklMopQ"
      src: 'FASHI Ya BEYI.mp3'
    },
    {
      id: 'track-2',
      title: 'Winners',
      artist: 'Cité MIAMI',
      artistId: 'czone',
      cover: 'czone3.jpeg',
      src: 'https://drive.google.com/uc?export=download&id=ID_GOOGLE_DRIVE_2'
    },
    {
      id: 'track-3',
      title: 'Volonté',
      artist: 'Cité Miami',
      artistId: 'dezball',
      cover: 'czone4.jpeg',
      src: 'https://drive.google.com/uc?export=download&id=ID_GOOGLE_DRIVE_3'
    }
  ];

  /* ======================================================
     ================ END EDIT AREA =======================
     ====================================================== */

  // ---------------------------
  // Small utilities
  // ---------------------------
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));
  const audio = $('#audio');

  // Play counts stored in localStorage for demo tracking
  const STORAGE_KEY = 'cm_play_counts_v1';
  function getPlayCounts(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}'); }catch(e){ return {}; } }
  function setPlayCounts(obj){ localStorage.setItem(STORAGE_KEY, JSON.stringify(obj)); }

  // ---------------------------
  // NAVIGATION / sections
  // ---------------------------
  const navButtons = $$('.nav button');
  function showSection(name){
    $$('.page').forEach(p => p.style.display = 'none');
    navButtons.forEach(b => b.classList.toggle('active', b.dataset.target === name));
    if(name === 'home') $('#home').style.display = 'block';
    if(name === 'chansons') $('#chansons').style.display = 'block';
    if(name === 'artistes') $('#artistes').style.display = 'block';
    if(name === 'apropos') $('#apropos').style.display = 'block';
    // hide artist profile if switching
    $('#artistProfile').style.display = 'none'; $('#artistProfile').setAttribute('aria-hidden','true');
    // focus search when going to chansons
    if(name === 'chansons') { setTimeout(()=> $('#search').focus(), 80) }
  }
  navButtons.forEach(btn => btn.addEventListener('click', ()=> showSection(btn.dataset.target)));

  // ---------------------------
  // RENDER FEED (HOME)
  // Tiles: New song, Most listened, Discover, Artist news, etc.
  // ---------------------------
  function mostListenedTrack(){
    const counts = getPlayCounts();
    let best = null; let bestCnt = -1;
    PLAYLIST.forEach(t => { const c = counts[t.id] || 0; if(c > bestCnt){ bestCnt=c; best=t; }});
    return best;
  }

  function renderFeed(){
    const feed = $('#feed');
    feed.innerHTML = '';

    // 1) New song (last in playlist)
    const latest = PLAYLIST[PLAYLIST.length - 1];
    feed.appendChild(makeTile({
      title: 'Nouveau — ' + latest.title,
      subtitle: latest.artist,
      img: latest.cover,
      action: () => loadAndPlayById(latest.id)
    }));

    // 2) Most listened
    const top = mostListenedTrack() || PLAYLIST[0];
    feed.appendChild(makeTile({
      title: 'La plus écoutée',
      subtitle: `${top.title} • ${top.artist}`,
      img: top.cover,
      action: () => loadAndPlayById(top.id)
    }));

    // 3) Discover Cité MIAMI
    feed.appendChild(makeTile({
      title: 'Découvrir Cité MIAMI',
      subtitle: 'Visite rapide — artistes, sons et nouveautés',
      img: ARTISTS[0].avatar,
      action: () => showSection('artistes')
    }));

    // 4) Artist News (dummy)
    feed.appendChild(makeTile({
      title: 'Artist News',
      subtitle: 'Nouvelles sorties & coulisses',
      img: ARTISTS[1].avatar,
      action: () => showSection('artistes')
    }));

    // 5) More tiles: generate a few themed tiles
    feed.appendChild(makeTile({title:'Top 3 cette semaine', subtitle:'Les morceaux qui chauffent', img:ARTISTS[2].avatar, action:()=>showSection('chansons')}));
    feed.appendChild(makeTile({title:'Playlist: Mood Route', subtitle:'Conduis avec la ville', img:ARTISTS[0].avatar, action:()=>showSection('chansons')}));
  }

  function makeTile({title, subtitle, img, action}){
    const d = document.createElement('div'); d.className='tile';
    d.innerHTML = `
      <img class="thumb" src="${img}" alt="${title}" />
      <h4>${title}</h4>
      <p>${subtitle}</p>
      <div class="meta"><span class="pill">Cité Miami</span><span class="pill">Now</span></div>
    `;
    d.addEventListener('click', action);
    return d;
  }

  // ---------------------------
  // RENDER SONGS GRID
  // ---------------------------
  function renderSongs(filter = ''){
    const grid = $('#songsGrid');
    grid.innerHTML = '';
    const q = (filter||'').trim().toLowerCase();
    PLAYLIST.filter(s => {
      if(!q) return true;
      return s.title.toLowerCase().includes(q) || s.artist.toLowerCase().includes(q);
    }).forEach(song => {
      const node = document.createElement('div'); node.className='song-tile';
      node.innerHTML = `
        <img class="song-cover" src="${song.cover}" alt="${song.title}" />
        <div class="song-meta">
          <div class="song-title">${song.title}</div>
          <div class="song-artist">${song.artist}</div>
          <div style="margin-top:8px;color:var(--muted);font-size:13px">
            Écoutes: <strong>${(getPlayCounts()[song.id]||0)}</strong>
            • <button class="btn-small" data-play="${song.id}">Lire</button>
            • <button class="btn-small" data-profile="${song.artistId}">Profil</button>
          </div>
        </div>
      `;
      grid.appendChild(node);
    });
  }

  // ---------------------------
  // RENDER ARTISTS LIST
  // ---------------------------
  function renderArtists(){
    const wrap = $('#artistsList'); wrap.innerHTML = '';
    ARTISTS.forEach(a=>{
      const card = document.createElement('div'); card.className='tile';
      card.style.padding='12px';
      card.innerHTML = `
        <img src="${a.avatar}" class="thumb" alt="${a.name}" />
        <h4>${a.name}</h4>
        <p>${a.genre}</p>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="btn-small" data-open="${a.id}">Voir profil</button>
          <button class="btn-small" data-playartist="${a.id}">Lire sa chanson</button>
        </div>
      `;
      wrap.appendChild(card);
    });
  }

  // ---------------------------
  // ARTIST PROFILE VIEW
  // ---------------------------
  function openArtistProfile(artistId){
    const artist = ARTISTS.find(a => a.id === artistId);
    if(!artist) return;
    $('#artistAvatar').src = artist.avatar;
    $('#artistName').textContent = artist.name;
    $('#artistGenre').textContent = artist.genre;
    $('#artistFullBio').textContent = artist.bio;
    // socials
    const socials = $('#artistSocials'); socials.innerHTML = '';
    Object.entries(artist.socials||{}).forEach(([k,v])=>{
      const a = document.createElement('a'); a.href=v; a.target='_blank'; a.textContent = k.toUpperCase();
      socials.appendChild(a);
    });
    // songs of the artist
    const songsWrap = $('#artistSongs'); songsWrap.innerHTML = '';
    PLAYLIST.filter(t => t.artistId === artistId).forEach(song => {
      const node = document.createElement('div'); node.className='song-tile';
      node.innerHTML = `<img class="song-cover" src="${song.cover}" alt="${song.title}" />
        <div class="song-meta"><div class="song-title">${song.title}</div><div class="song-artist">${song.artist}</div>
        <div style="margin-top:8px"><button class="btn-small" data-play="${song.id}">Lire</button></div></div>`;
      songsWrap.appendChild(node);
    });

    // show artist page
    $$('.page').forEach(p=>p.style.display='none'); $('#artistProfile').style.display='block'; $('#artistProfile').setAttribute('aria-